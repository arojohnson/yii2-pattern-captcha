var patternLock=function(){function e(){for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++)"patternlock"==e[t].className&&((i=e[t]).value="",n(e[t])),e[t].type}var d,a=!1,o="",l="",r=!1,u=[],p=[],i={},m=[];var n=function(e){(d=e).style.display="none";var t=e.parentNode,n=document.createElement("div");n.className="patternlockcontainer";var a=document.createElement("div");a.className="patternlocklineshorizontalcontainer";for(var o=["12","23","45","56","78","89"],i=0;i<6;i++){(l=document.createElement("div")).className="patternlocklinehorizontal",l.id="line"+o[i],p.push(l),a.appendChild(l)}n.appendChild(a),(a=document.createElement("div")).className="patternlocklinesverticalcontainer",o=["14","25","36","47","58","69"];for(i=0;i<6;i++){(l=document.createElement("div")).className="patternlocklinevertical",l.id="line"+o[i],p.push(l),a.appendChild(l)}n.appendChild(a),(a=document.createElement("div")).className="patternlocklinesdiagonalcontainer",o=["24","35","57","68"];for(i=0;i<4;i++){(l=document.createElement("div")).className="patternlocklinediagonalforward",l.id="line"+o[i],p.push(l),a.appendChild(l)}n.appendChild(a),o=["15","26","48","59"],(a=document.createElement("div")).className="patternlocklinesdiagonalcontainer";for(i=0;i<4;i++){var l;(l=document.createElement("div")).className="patternlocklinediagonalbackwards",l.id="line"+o[i],p.push(l),a.appendChild(l)}n.appendChild(a);var r=document.createElement("div");r.className="patternlockbuttoncontainer",m=function(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[a-=1],e[a]=e[n],e[n]=t;return e}(m=[1,2,3,4,5,6,7,8,9]);for(i=1;i<10;i++){var s=document.createElement("div");s.className="patternlockbutton",s.id="patternlockbutton"+i,s.setAttribute("data-count",m[i-1]),window.navigator.msPointerEnabled?(s.onpointerdown=s.onmspointerdown=function(e){e.preventDefault(),f(this)},s.onpointermove=s.onmspointermove=function(e){e.preventDefault(),g(parseInt(e.pageX),parseInt(e.pageY))},s.onpointerup=s.onmspointerup=function(){y(this)}):(s.onmousedown=function(e){e&&e.preventDefault&&e.preventDefault(),f(this)},s.ontouchstart=function(e){e||(e=window.event),e.preventDefault(),f(this)},s.onmouseover=function(){v(this)},s.ontouchmove=h,s.onmouseup=function(){y(this)},s.ontouchend=function(){y()}),u.push(s),r.appendChild(s)}n.appendChild(r);var c=document.createElement("div");c.style.display="none",c.className="patternlockbutton touched",n.appendChild(c),(c=document.createElement("div")).style.display="none",c.className="patternlockbutton touched multiple",n.appendChild(c),t.appendChild(n)},f=function(e){return a=!0,""!=d.value&&s(),e.className="patternlockbutton touched",o="",l=e.id.split("patternlockbutton").join(""),d.value=l,l,!1},v=function(e){if(a){var t=e.id.split("patternlockbutton").join("");if(t!=l){e.className.indexOf("touched")<0?e.className="patternlockbutton touched":e.className="patternlockbutton touched multiple",o=l,l=t,d.value+=l;var n=document.getElementById("line"+o+l);l<o&&(n=document.getElementById("line"+l+o)),n&&(n.style.visibility="visible")}}return!1},h=function(e){if(1==e.touches.length){var t=e.touches[0];g(parseInt(t.pageX),parseInt(t.pageY))}},g=function(e,t){r||(u[0].pos=c(u[0]),u[1].pos=c(u[1]),r=parseInt(u[1].pos.left)-parseInt(u[0].pos.left));var n=e-parseInt(u[0].pos.left),a=t-parseInt(u[0].pos.top),o=Math.min(2,Math.max(0,Math.floor(n/r)))+3*Math.min(2,Math.max(0,Math.floor(a/r)))+1;if(o!=l&&(n%r<r/2&&a%r<r/2)){var i=u[o-1];v(i)}},y=function(){a&&(r=a=!1,function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=document.getElementsByClassName("allPatternBox"),n=document.getElementsByClassName("jsucc");"1"===e.status.toString()?(t[0].style.display="none",n[0].style.display="block",i.value="true"):(s(),t[0].style.display="block",i.value="")}},e.open("POST",i.getAttribute("data-url"),!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader(yii.getCsrfParam(),yii.getCsrfToken());var t=i.value.toString().split("").reverse().join("");e.send("jcode="+t+"&data="+m.join("-")+"&"+yii.getCsrfParam()+"="+yii.getCsrfToken())}());return!1},s=function(){var e,t;for(e=0,t=u.length;e<t;e++)u[e].className="patternlockbutton";for(e=0,t=p.length;e<t;e++)p[e].style.visibility="hidden";d.value=""};function c(e){var t=curtop=0;if(e.offsetParent)for(;t+=e.offsetLeft,curtop+=e.offsetTop,e=e.offsetParent;);return{left:t,top:curtop}}function t(e,t,n){n=window.addEventListener?n:"on"+n,e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent(n,t)}return t(window,function(){e()},"load"),t(document,function(){y()},"mouseup"),{init:e,generate:n,clear:s}}();